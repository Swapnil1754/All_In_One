import { StrategyIndex } from '../services/strategyIndex';
import { StorageKeyManager } from './storageKeyManager';
import { noop } from './noop';
export class DecoratorBuilder {
    static buildSyncStrategyDecorator(strategyName, prototype, propName, key, defaultValue = null) {
        const rawKey = key || propName;
        let storageKey;
        Object.defineProperty(prototype, propName, {
            get: function () {
                let value;
                StrategyIndex.get(strategyName).get(getKey()).subscribe((result) => value = result);
                return value === undefined ? defaultValue : value;
            },
            set: function (value) {
                StrategyIndex.get(strategyName).set(getKey(), value).subscribe(noop);
            }
        });
        function getKey() {
            if (storageKey !== undefined)
                return storageKey;
            return storageKey = StorageKeyManager.normalize(rawKey);
        }
    }
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZGVjb3JhdG9yQnVpbGRlci5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uLy4uLy4uLy4uLy4uL3Byb2plY3RzL25neC13ZWJzdG9yYWdlL3NyYy9saWIvaGVscGVycy9kZWNvcmF0b3JCdWlsZGVyLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBLE9BQU8sRUFBQyxhQUFhLEVBQUMsTUFBTSwyQkFBMkIsQ0FBQztBQUV4RCxPQUFPLEVBQUMsaUJBQWlCLEVBQUMsTUFBTSxxQkFBcUIsQ0FBQztBQUN0RCxPQUFPLEVBQUMsSUFBSSxFQUFDLE1BQU0sUUFBUSxDQUFDO0FBRTVCLE1BQU0sT0FBTyxnQkFBZ0I7SUFFNUIsTUFBTSxDQUFDLDBCQUEwQixDQUFDLFlBQXdDLEVBQUUsU0FBUyxFQUFFLFFBQWdCLEVBQUUsR0FBWSxFQUFFLGVBQW9CLElBQUk7UUFDOUksTUFBTSxNQUFNLEdBQVcsR0FBRyxJQUFJLFFBQVEsQ0FBQztRQUN2QyxJQUFJLFVBQWtCLENBQUM7UUFFdkIsTUFBTSxDQUFDLGNBQWMsQ0FBQyxTQUFTLEVBQUUsUUFBUSxFQUFFO1lBQzFDLEdBQUcsRUFBRTtnQkFDSixJQUFJLEtBQVUsQ0FBQztnQkFDZixhQUFhLENBQUMsR0FBRyxDQUFDLFlBQVksQ0FBQyxDQUFDLEdBQUcsQ0FBQyxNQUFNLEVBQUUsQ0FBQyxDQUFDLFNBQVMsQ0FBQyxDQUFDLE1BQU0sRUFBRSxFQUFFLENBQUMsS0FBSyxHQUFHLE1BQU0sQ0FBQyxDQUFDO2dCQUNwRixPQUFPLEtBQUssS0FBSyxTQUFTLENBQUMsQ0FBQyxDQUFDLFlBQVksQ0FBQyxDQUFDLENBQUMsS0FBSyxDQUFDO1lBQ25ELENBQUM7WUFDRCxHQUFHLEVBQUUsVUFBUyxLQUFLO2dCQUNsQixhQUFhLENBQUMsR0FBRyxDQUFDLFlBQVksQ0FBQyxDQUFDLEdBQUcsQ0FBQyxNQUFNLEVBQUUsRUFBRSxLQUFLLENBQUMsQ0FBQyxTQUFTLENBQUMsSUFBSSxDQUFDLENBQUM7WUFDdEUsQ0FBQztTQUNELENBQUMsQ0FBQztRQUVILFNBQVMsTUFBTTtZQUNkLElBQUksVUFBVSxLQUFLLFNBQVM7Z0JBQUUsT0FBTyxVQUFVLENBQUM7WUFDaEQsT0FBTyxVQUFVLEdBQUcsaUJBQWlCLENBQUMsU0FBUyxDQUFDLE1BQU0sQ0FBQyxDQUFDO1FBQ3pELENBQUM7SUFDRixDQUFDO0NBQ0QiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQge1N0cmF0ZWd5SW5kZXh9IGZyb20gJy4uL3NlcnZpY2VzL3N0cmF0ZWd5SW5kZXgnO1xuaW1wb3J0IHtTdG9yYWdlU3RyYXRlZ2llc30gZnJvbSAnLi4vY29uc3RhbnRzL3N0cmF0ZWd5JztcbmltcG9ydCB7U3RvcmFnZUtleU1hbmFnZXJ9IGZyb20gJy4vc3RvcmFnZUtleU1hbmFnZXInO1xuaW1wb3J0IHtub29wfSBmcm9tICcuL25vb3AnO1xuXG5leHBvcnQgY2xhc3MgRGVjb3JhdG9yQnVpbGRlciB7XG5cdFxuXHRzdGF0aWMgYnVpbGRTeW5jU3RyYXRlZ3lEZWNvcmF0b3Ioc3RyYXRlZ3lOYW1lOiBzdHJpbmcgfCBTdG9yYWdlU3RyYXRlZ2llcywgcHJvdG90eXBlLCBwcm9wTmFtZTogc3RyaW5nLCBrZXk/OiBzdHJpbmcsIGRlZmF1bHRWYWx1ZTogYW55ID0gbnVsbCkge1xuXHRcdGNvbnN0IHJhd0tleTogc3RyaW5nID0ga2V5IHx8IHByb3BOYW1lO1xuXHRcdGxldCBzdG9yYWdlS2V5OiBzdHJpbmc7XG5cdFx0XG5cdFx0T2JqZWN0LmRlZmluZVByb3BlcnR5KHByb3RvdHlwZSwgcHJvcE5hbWUsIHtcblx0XHRcdGdldDogZnVuY3Rpb24oKSB7XG5cdFx0XHRcdGxldCB2YWx1ZTogYW55O1xuXHRcdFx0XHRTdHJhdGVneUluZGV4LmdldChzdHJhdGVneU5hbWUpLmdldChnZXRLZXkoKSkuc3Vic2NyaWJlKChyZXN1bHQpID0+IHZhbHVlID0gcmVzdWx0KTtcblx0XHRcdFx0cmV0dXJuIHZhbHVlID09PSB1bmRlZmluZWQgPyBkZWZhdWx0VmFsdWUgOiB2YWx1ZTtcblx0XHRcdH0sXG5cdFx0XHRzZXQ6IGZ1bmN0aW9uKHZhbHVlKSB7XG5cdFx0XHRcdFN0cmF0ZWd5SW5kZXguZ2V0KHN0cmF0ZWd5TmFtZSkuc2V0KGdldEtleSgpLCB2YWx1ZSkuc3Vic2NyaWJlKG5vb3ApO1xuXHRcdFx0fVxuXHRcdH0pO1xuXHRcdFxuXHRcdGZ1bmN0aW9uIGdldEtleSgpIHtcblx0XHRcdGlmIChzdG9yYWdlS2V5ICE9PSB1bmRlZmluZWQpIHJldHVybiBzdG9yYWdlS2V5O1xuXHRcdFx0cmV0dXJuIHN0b3JhZ2VLZXkgPSBTdG9yYWdlS2V5TWFuYWdlci5ub3JtYWxpemUocmF3S2V5KTtcblx0XHR9XG5cdH1cbn1cblxuIl19